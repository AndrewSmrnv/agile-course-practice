# Лабораторная работа #0: Настройка окружения

---
* [Постановка задачи](#Постановка-задачи)
   * [Цели](#Цели)
   * [Задачи](#Задачи)
   * [Общая последовательность действий](#Общая-последовательность-действий)
   * [Типичные ошибки](#Типичные-ошибки)
* [Детальные инструкции](#Детальные-инструкции)
   * [Первичная настройка](#Первичная-настройка)
   * [Выполнение лабораторной](#Выполнение-лабораторной)
   * [Ревью кода](#Ревью-кода)
---

## Постановка задачи

### Цели

  1. Ознакомиться с общей процедурой приема лабораторных работ.
  1. Познакомиться с инфраструктурой GitHub + Travis CI и принятым там процессом разработки (workflow).
  1. Освоить Git на уровне, необходимом для выполнения лабораторных работ.

### Задачи

Настоящей задачей этой лабораторной работы является разворачивание рабочего окружения на своей рабочей машине, и создание пробного пулл-реквеста.

Делаем мы это на примере добавления нескольких модульных тестов на уже существующий класс `ComplexNumber`, попутно изучая как проводить тестирование локально, в своем форке и на центральном репозитории.

### Общая последовательность действий

Ниже приводится краткая инструкция по выполнению задания. Если вам не требуются более подробные инструкции, то можно просто идти по перечисленным шагам. Если же нужны более подобные инструкции, то стоит обратиться к [Детальным инструкциям](#Детальные-инструкции).

1. Вступите в [Gitter-чат][chat], который мы будем использовать для общения. Со всеми вопросами необходимо обращаться туда.

1. Выберите тему лабораторной работы из предложенного [списка][topics]. При желании можно предложить свою, но нужно будет согласовать ее с преподавателем.

1. Создайте свой форк [центрального репозитория][central-repo] и клонируйте его к себе на машину. Мы будем называть ваш форк `origin`, а центральный репозиторий -- `upstream`.

1. В отдельной ветке Git добавьте 2-3 smoke-теста на класс `ComplexNumber`. Для этого создайте отдельный файл в модуле `korniakov-kirill-lab1`, за основу можете взять `KorniakovKirillTest.java`.

1. Выполните локальное тестирование при помощи команды `$ gradle check` в командной строке или в IDE. Убедитесь, что созданные вами тесты успешно запускаются и корректно завершаются.

1. Включите тестирование для своего форка на Travis CI. Для этого залогиньтесь на [travis-ci.org][travis] при помощи вашего GitHub-аккаунта, и включите тестирование для своего репозитория. После этого создайте пулл-реквест в ветку `origin/master`, чтобы убедиться, что тесты успешно проходят.
    - Тестирование `origin` удобно тем, что вам не придется долго ждать своей очереди тестирования в репозитории `upstream`, поскольку там будет происходить коллективная работа.
    - Также перед посылкой пулл-реквеста в ветку `origin/master`, полезно ее обновить до состояния `upstream/master`, поскольку последняя могла обновиться и могли возникнуть конфликты.

1. Когда вы убедитесь, что пулл-реквест в вашем `origin` репозитории успешно проходит тестирование, пошлите пулл-реквест в `upstream` репозиторий и пройдите рецензию кода. Сначала вам необходимо получить два одобрения (`+1`) от сокурсников, затем от одного интеграционного менеджера.

### Типичные ошибки

Ниже приведены типичные ошибки, при наличии которых лабораторная не будет принята:

- Работа велась в ветке `master`.
- Изменяются какие-то файлы, кроме нового файла с тестами.
    - __NOTE__: если вы хотите что-то улучшить в проекте-шаблоне, это приветствуется, но просьба делать в отдельной ветке и отдельным пулл-реквестом.

## Детальные инструкции

### Установка зависимостей

1. Если у вас нет аккаунта на GitHub, то нужно будет зарегистрироваться там. Предпочтительно использование аккаунта, из котого понятно ваше имя.

1. Установите и настройте себе Git, используя
инструкции например [отсюда][help-git].

1. Для этого курса нам потребуется Java следующей версии: Java SE Development Kit 8u181, которую можно скачать со [следующей страницы][java-download]. Будьте внимательны, нам потребуется именно Java 8, с другими версиями проект скорее всего не заработает.

1. Затем следует установить систему сборки [Gradle][gradle], и добавить путь до её бинарника в `PATH`.

### Первичная настройка

1. Вступите в [Gitter-чат][chat], который мы будем использовать для общения. Со всеми вопросами необходимо обращаться туда.

1. Выберите себе свободную тему из [списка][topics], вписав свое имя и группу. Полезно разбиться на группы по три человека, и занять какие-то три темы. Это позволит вам работать синхронно, поскольку вы будете зависеть друг от друга.

1. Создайте форк [проекта-шаблона][central-repo], затем клонируйте репозиторий к себе на рабочую машину. Все необходимые инструкции можно найти [здесь][help-fork].

1. Включите тестирование своего `origin` репозитория на Travis CI. Для этого войдите в свой личный кабинет, синхронизируйте репозитории с GitHub и переведите тумблер для проекта `agile-cource-practice` в положение ON.

При необходимости можно посмотреть [запись][gitcast] демонстрации Git + GitHub.

### Выполнение лабораторной

1. Создайте новую ветку, в которой вы будете работать над лабораторной:

    ```bash
        $ git clone https://github.com/YOUR_GITHUB_NAME/agile-course-practice
        $ cd agile-course-practice
        $ git checkout -b surname-name-lab0
    ```

1. Перед началом работы полезно построить проект и убедиться, что ваше окружение сконфигурировано и тесты проходят. Для этого достаточно выполнить команду `$ gradle check` в командной строке (на Windows весьма удобно работать в Git Bash).
    - __Крайне полезно знать про этот режим запуска из командной строки__, поскольку Travis CI запускает тесты аналогичным образом. Поэтому если ваш пулл-реквест будет красным, то вы будете в состоянии воспроизвести И починить проблему у себя локально.

    ```Bash
        $ gradle check
    ```

1. Эту лабораторную можно выполнять в простом тестовом редакторе, осуществляя тестирование командой `$ gradle check` как показано выше. Тем не менее, если хотите, ее же можно сделать и в IDE. В случае с IDEA нужно сгенерировать при помощи Gradle проект, и уже его открыть в IDE:

    ```Bash
        $ gradle idea
        # Now you can open generated project in IDEA
    ```

1. Далее создайте новый java-файл, и реализуйте в нем требуемые модульные тесты.

    ```bash
        $ cd  code/korniakov-kirill-lab1/src/test/java/ru/unn/agile/complexnumber/model/
        $ touch SurnameNameTest.java
        # Implementing unit-tests in the SurnameNameTest.java
    ```

1. Когда закончите разработку тестов, нужно сделать локальный коммит в Git:

    ```bash
        $ git add SurnameNameTest.java
        $ git commit -m "Added more unit tests"
    ```

1. Далее сделайте `git push` в свой форк проекта:

    ```bash
        $ git push origin HEAD
    ```

1. Далее создайте пулл реквест в `origin/master` и убедитесь, что тестирование на Travis CI запустилось и успешно завершилось.

1. Если нужно будет что-то поправить в своих кодах, используйте следующие команды:

    ```bash
        # Editing SurnameNameTest.java...
        $ git add SurnameNameTest.java
        $ git commit -m "Edited tests"
        $ git push origin HEAD
    ```

1. Когда вы завершите стабилизацию, можно будет переходить к рецензии кода. Однако __обратите внимание, что пулл-реквесты в свой `origin/master` вливать никогда не нужно__! Этот пулл-реквест был создан лишь для того, чтобы его тестировал Travis. Обновляться `origin/master` должен только на состояние `upstream/master`, и делать это нужно чтобы Travis тестировал ваши изменения относительно состояния `upstream/master`.

### Ревью кода

1. Затем нужно сделать [pull-request][help-pr] в центральный репозиторий. В названии pull-request нужно указать свою фамилию и номер лабораторной, например _"Корняков -- Лабораторная работа #0"_.

1. Первым делом необходимо убедиться, что успешно прошло тестирование на [Travis CI][travis]. Если нужно будет что-то поправить, делайте это как показано выше, в той же ветке и том же пулл-реквесте.

1. Далее необходимо пройти ревью кода от двух своих сокурсников. Пригласите их к дискуссии, дабавив в pull reqeust комментарий вида `@github-name` (например `@kirill-korniakov`).

1. Если будут замечания к вашему коду, вам нужно добавлять коммиты в свою ветку, и пулл-реквест будет автоматически обновляться.

    ```bash
        # Editing SurnameNameTest.java...
        $ git add SurnameNameTest.java
        $ git commit -m "Edited tests"
        $ git push origin HEAD
    ```

1. Формально вам нужно получить два комментария вида :+1: (пишется как `:+1:`). Наличие такого значка  означает одобрение рецензентом ваших изменений. Затем необходимо аналогичным образом пригласить одного из интеграционных менеджеров и пройти окончательное ревью.
     - Обращаем внимание, что некачественные рецензии будут заворачиваться.

После прохождения ревью код будет влит в основную ветку `master`, и лабу можно считать завершенной. Датой сдачи лабораторной будет считаться дата вливания.

<!-- LINKS -->

[chat]:         https://gitter.im/agile-course-practice-2018/Lobby
[topics]:       https://docs.google.com/spreadsheets/d/1JXyJBOlLZ8yvMGVVAJ6U3uiH10mMzcm-6n77SWg3p9Q/edit#gid=8
[central-repo]: https://github.com/UNN-VMK-Software/agile-course-practice
[help-git]:     https://help.github.com/articles/set-up-git
[help-fork]:    https://help.github.com/articles/fork-a-repo
[help-pr]:      https://help.github.com/articles/using-pull-requests
[gfm]:          https://help.github.com/articles/github-flavored-markdown
[travis]:       https://travis-ci.org/UNN-VMK-Software/agile-course-practice/pull_requests
[gitcast]:      http://www.youtube.com/playlist?list=PLSzOhsr5tmhrgV7u7CSzX4Ki1a9r0AKzV
[java-download]: https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html
[gradle]:       http://www.gradle.org/downloads
