# Лабораторная работа #1: Test-Driven Development

---
* [Постановка задачи](#Постановка-задачи)
   * [Цели](#Цели)
   * [Задачи](#Задачи)
   * [Типичные ошибки](#Типичные-ошибки)
* [Детальные инструкции](#Детальные-инструкции)
   * [Установка зависимостей](#Установка-зависимостей)
   * [Выполнение лабораторной](#Выполнение-лабораторной)
   * [Интеграция](#Интеграция)
---

## Постановка задачи

### Цели

1. Освоить практику разработки Test-Driven Development (TDD).

1. Освоить "гибкую" практику объектно-ориентированного дизайна, рассмотренную в лекциях "TDD", "Чистый код", "Рефакторинг".

1. Углубить знакомство с практикой Непрерывной интеграции.

### Задачи

1. Доустановить инструменты разработки в виде IDE (рекомендуется IntelliJ IDEA Community Edition).

1. Разработать Java-компонент с основной логикой приложения согласно практике Test-Driven Development (TDD). Классы должны быть "грамотно" спроектированы, должны выполняться рекомендации из лекции "Чистый код".

1. Пройти локальное тестирование, после чего на Travis CI из своего форка. Затем прислать результаты в виде пулл-реквеста в `upstream` репозиторий, и пройти окончательные проверки (снова Travis и рецензии кода).

### Типичные ошибки

1. __Следует строго следовать практике TDD__, то есть сперва писать тесты и только потом реализацию, иначе противное будет заметно сразу.
    - Если тестов будет мало, их придется писать, пока их не станет по ~3 штуки на каждый публичный метод. Поэтому лучше сразу пишите по TDD.
    - В целом следите за выполнением цикла Red-Green-Refactor, который вы должны проходить за 5-10 минут. Если получаете дольше, разбивайте задачу на подзадачи.

1. Просьба следовать процессу [GitHub Flow][github-flow].
    - Это подразумевает, что разработку вы ведете в отдельной ветке Git. Просьба дать ей содержательное имя, например `lab1-tdd-triangle`.
    - Кроме того, если к вашему коду будут поступать замечания, то просьба не создавать новые ветки и пулл-реквесты, а использовать те же самые. Так, при `git push` коммитов в ветку `lab1-tdd-triangle` на вашем форке, пулл-реквест обновится автоматически.

1. Не нужно делать коммиты бинарных файлов и других временных файлов от IDE. `gitignore` должен отсечь большинство таких случаев, тем не менее просьба быть внимательным, когда вы добавляете файлы в Git.

## Детальные инструкции

### Установка зависимостей

Теперь нужно установить IDE и попробовать импортировать проекты в директории `code`.

- Если вы планируете использовать IntelliJ IDEA (рекомендуется), то она автоматически "понимает" проекты Gradle. Однако, этот режим не всегда работает правильно, поэтому предлагается не открывать проект в IDEA, а сперва сгенерировать проект следующей командой в командной строке:

    ```bash
        $ gradle idea
    ```

- Аналогично, если вы планируете использовать Eclipse, прежде чем импортировать, вам предстоит сгенерировать Eclipse-проект. Для этого снова перейдите в консоли в корневую папку и выполните команду `$ gradle eclipse`. В результате в каждой подпапке появится проект Eclipse, который теперь можно импортировать.

Далее нужно запустить все тесты и убедиться, что они проходят, пока вы еще не начали вносить изменения.

### Выполнение лабораторной

1. Первым делом обязательно нужно обновить коды из центрального репозитория ([upstream][git-pull]). Когда вы скачаете коды, можно будет создавать ветку (например, `lab1-tdd-triangle`) на основе `upstream/master` и продолжать в ней работу. Вот примерные команды, которые вы должны использовать:

    ```bash
        $ cd agile-course-practice
        $ git remote add upstream https://github.com/UNN-VMK-Software/agile-course-practice
        $ git fetch upstream
        $ git checkout -b lab1-tdd-triangle upstream/master
    ```

1. Далее вы можете начинать работу над своим проектом. Для простоты можно скопировать проект `korniakov-kirill-lab1`, и переиспользовать его структуру, переименовав все под свою лабораторную. Конечно, все Java-файлы придется удалить и написать заново. Скопированный проект можно импортировать в IDE и собственно приступить к разработке своего компонента.
    - __Внимание:__ просьба все последующие лабораторные выполнять в той же директории с модулем, развивая и наращивая проект. Папки с примерами (вида `kirill-korniakov-lab1`, `kirill-korniakov-lab2` и т.п.) созданы лишь для того, чтобы вы видели разницу между лабораторными. Вы же должны работать в одной папке.

1. Свой подпроект необходимо включить в общую процедуру построения. Для этого нужно обновить общий файл с перечислением подпроектов, располагающийся по следующему пути: `agile-course-practice/settings.gradle`. Найдите там строку со своей фамилией, и вставьте нужные строки в вашу секцию (подобно тому как сделано в проекте у Антона Бевзюка и в проекте-примере).

1. Собственно далее вы должны разработать свой класс, решающий поставленную задачу, согласно практике TDD. Перед этим рекомендуется освежить в памяти [ключевые рекомендации][tddcast].
    - __Настоятельно рекомендуется__ соблюдать все рекомендации практики TDD: создание теста до кода, маленькие итерации (думаете больше 5 минут -- пишите вспомогательный класс или метод), осуществляйте периодический рефакторинг кода и тестов.
    - __На каждый метод у вас должно получиться порядка 3 тестов__: пара smoke тестов (просто на корректную работу), затем граничные значения и неадекватные/недопустимые аргументы.
    - Кроме того, огромная просьба следить за чистотой кода, понятностью имен и следованию [Java-соглашениям][codestyle] программирования.

### Интеграция

1. Когда все будет готово, нужно будет прислать пулл-реквест и убедиться, что он [зеленый][agile-travis]. Если это не так, просьба самостоятельно разрешить все проблемы.
    - Как и в первом случае, полезно сперва стабилизироваться в своем форке, чтобы не дожидаться общей очереди на Travis CI, который тестирует `upstream` репозиторий.
    - Напоминаем, что пулл-реквест мержить в origin не нужно, изменения потом придут из `upstream/master` когда будет замержен ваш пулл-реквест уже в центральный репозиторий, и вы руками обновите `origin/master` для следующего цикла тестирования.

    ```Bash
        $ git remote update
        $ git push origin upstream/master:master
        $ git checkout -b lab1-tdd-triangle
        $ git push origin HEAD
        # Create pull request to origin/master and see Travis CI
    ```

1. Когда вы стабилизируетесь в своем форке создайте пулл-реквест в центральный репозиторий. Код должен рецензироваться только если пулл-реквест проходит все тесты. (Среди прочего, Travis CI автоматически проверяет проверяться стиль кодирования.)
    - Как обычно, сперва нужно пройти ревью у двоих однокурсников и получить их :+1:. Если в свою очередь вы рецензируете чей-то код, то делайте это тщательно и ответственно. Проверяйте стиль кодирования, полноту тестов, удобство API и дизайна, понятность кода. Все замечания высказывайте автору.
    - Полученные замечания нужно своевременно устранять, и это нужно делать в той же ветке и в том же пулл-реквесте. Когда все замечания будут устранены (чаще всего они на чистоту кода), нужно пригласить к рецензии интеграционных менеджеров.

Как всегда, эта лабораторная будет считаться засчитанной в тот момент, когда pull request интегрируется в ветку `master` центрального репозитория.

<!-- LINKS -->

[github-flow]:  http://scottchacon.com/2011/08/31/github-flow.html
[git-pull]:     https://groups.google.com/d/msg/devtools-course/V8rtlLrCXc4/k7vx6BxnqR4J
[agile-travis]: https://travis-ci.org/UNN-VMK-Software/agile-course-practice/pull_requests
[upstream]:     https://github.com/UNN-VMK-Software/agile-course-practice
[codestyle]:    http://www.oracle.com/technetwork/java/javase/documentation/codeconvtoc-136057.html
[tddcast]:      http://www.youtube.com/watch?v=lDdJYid8NpE
